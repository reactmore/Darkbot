# Darkbot

A modular Telegram multi-bot runtime powered by Darkbot migrate Gramjs with **Teleproto**.

Supports:

- Userbot
- Multi Bot Tokens
- External Bot via Gist
- External Bot via GitHub Repository
- Modular Command Architecture
- Database-backed Conversation System

---

## ğŸš€ Features

- Multi bot instance manager
- Modular bot structure (admin/user/system)
- Gist plugin support
- GitHub repository support
- Auto BOT_TOKEN injection
- Conversation flow engine (DB based)
- PM2 ready
- SQLite / MySQL support

---

## ğŸ“¦ Installation

```bash
git clone https://github.com/reactmore/DarkRuntime
cd DarkRuntime
npm install
```

---

## âš™ Setup Environment

```bash
npm run postinstall
```

Edit `.env` file if needed.

---

## ğŸ§ª Run Development

```bash
npm run dev
```

---

## ğŸ­ Run Production (Recommended)

```bash
npm start
```

(Powered by PM2)

---

## ğŸ—„ Database Configuration

### SQLite (default)

```
DATABASE_URL="sqlite"
```

### MySQL

```
DB_DATABASE=darkruntime
DB_USERNAME=root
DB_PASSWORD=
DB_HOST=localhost
```

---

# ğŸ¤– External Bot Installation

Inside BotFather:

```
/addbot
```

You will be asked:

1. Bot Token  
2. Gist Raw URL OR GitHub Repository URL  

---

# ğŸ“¦ Supported External Bot Formats

---

## 1ï¸âƒ£ GIST FORMAT (Single File)

Example:

```
https://gist.github.com/reactmore/77c6a9825a8ef70c9086ee3c80869753
```

Example file:

```js
const { botHandler } = require("../../handler");

botHandler({
  name: "PingExternalBot",
  BOT_TOKEN,
  commands: [
    {
      pattern: "start",
      description: "Start command",
      callback: async (m) => {
        await m.send("Bot running ğŸš€");
      }
    }
  ]
});
```

---

## 2ï¸âƒ£ REPOSITORY FORMAT (Recommended)

Example:

```
https://github.com/reactmore/PingProBot
```

### Repository structure:

```
PingProBot/
 â”œâ”€â”€ index.js
 â”œâ”€â”€ admin/
 â”‚    â””â”€â”€ stats.js
 â”œâ”€â”€ user/
 â”‚    â”œâ”€â”€ ping.js
 â”‚    â””â”€â”€ start.js
 â””â”€â”€ system/
      â””â”€â”€ inline.js
```

### index.js example:

```js
const { botHandler } = require("../../handler");

botHandler({
  name: "PingProBot",
  BOT_TOKEN,
  commandsPath: __dirname
});
```

---

# ğŸ§© Modular Command Example

### user/ping.js

```js
module.exports = {
  pattern: "ping",
  description: "Ping test",
  callback: async (m) => {
    await m.send("Pong ğŸš€");
  }
};
```

---

# ğŸ”„ Conversation System

Conversation stored in DB:

- userId
- botToken
- flow
- step
- active
- completedAt

Supports:

```
/cancel
```

to stop active conversation.

---

# ğŸ›  Migrations

```bash
npx sequelize-cli db:migrate
```

---

# ğŸ“ Project Bot Token Structure

```
runtime/
 â”œâ”€â”€ bots/
 â”œâ”€â”€ loader/
 â”œâ”€â”€ manager/
 â”œâ”€â”€ conversation/
```

---

# âš  Notes

- Use PM2 in production
- Avoid rapid bot restarts (Telegram flood protection)
- FloodWait automatically handled
- External bots are auto-downloaded if missing

---

# ğŸ· Version

Current version: **2.0.0**

---

# ğŸ§  Architecture Summary

- Teleproto based runtime
- Multi-bot support
- DB-driven conversations
- Modular external bot system
- Gist & GitHub repository support
- Clean restart model (no hot reload hacks)

---
